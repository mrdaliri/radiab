"use strict";var API="http://localhost:8080",issImages=["dist/img/1.jpg","dist/img/2.jpg","dist/img/3.jpg","dist/img/4.jpg","dist/img/5.jpg","dist/img/6.jpg"];$(function(){var n=[["inhalation_radiation","Inhalation Radiation"],["cosmic_radiation","Cosmic Radiation"],["terrestrial_radiation","Terrestrial Radiation"],["radionuclide_radiation","Radionuclide Radiation"],["neutron_radiation","Neutron Radiation"]],a=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:8,minZoom:3,id:"mapbox.streets",accessToken:"pk.eyJ1IjoibXJkYWxpcmkiLCJhIjoiY2sxeHN4emgyMGczczNubDJxeGxvMng4NCJ9.UeSLlOWRGvJR-HesGdPRLg"}),t=new HeatmapOverlay({radius:70,scaleRadius:!1,useLocalExtrema:!1,latField:"lat",lngField:"lng",valueField:"total_radiation"}),e=new L.Map("map",{center:new L.LatLng(50.701779,-98.088385),zoom:4,layers:[a,t]}),i=$("#date-picker");data.forEach(function(a){i.append($("<option>",{value:a.date.date,text:a.date.label}))});function o(a){d=this.options.record,f(),g(),$("#info").removeClass("d-none"),p()}i.change(function(){r=data.filter(function(a){return a.date.date==i.val()})[0].records,m(),u()});var r=[],s=0,d=null,c=null,l=[],m=function(){l&&l.forEach(function(a){return e.removeLayer(a)}),r.forEach(function(a){var t=L.marker([a.lat,a.lng],{record:a});t.on("click",o).addTo(e),l.push(t)}),$("#info").addClass("d-none")},u=function(){var a=0;r.forEach(function(t){var e=0;n.forEach(function(a){return e+=t[a[0]]}),t.total_radiation=e,a<e&&(a=e)}),t.setData({max:a,data:0<a?r:[]})};u();var p=function(){c&&c.destroy();var t=[],e=s+d.total_radiation;n.forEach(function(a){t.push({y:Math.round(d[a[0]]/e*100),name:a[1],exact:d[a[0]]})}),0<s&&t.push({y:Math.round(s/e*100),name:"Other",exact:s.toFixed(3)}),(c=new CanvasJS.Chart("chart",{animationEnabled:!0,data:[{type:"pie",toolTipContent:"{name}: <strong>{y}%</strong>",indexLabel:"{name} - {exact} mrem ({y}%)",dataPoints:t}]})).render()},f=function(){var a=$("#conclusion"),t=parseFloat(a.data("safe"));d.total_radiation>t?(a.removeClass("alert-success").addClass("alert-danger"),a.find("strong.status").text("UNSAFE")):(a.removeClass("alert-danger").addClass("alert-success"),a.find("strong.status").text("SAFE")),a.find("strong.value").text((d.total_radiation+s).toFixed(3)+" mrem"),a.find("strong.city").text(d.city+", "+d.province)},g=function(){var a=$("#iss-comparison"),t=issImages[Math.floor(Math.random()*issImages.length)];a.find("img").attr("src",t),a.find("strong.value").text(d.iss_neutron_radiation+" mrem")};$("input.activity").change(function(){var a=$(this),t=$("#notes");a.is(":checked")?(t.find(".empty").hide(),t.find("#note-"+a.attr("id")).removeClass("d-none"),s+=parseFloat(a.data("exposure"))):(t.find("#note-"+a.attr("id")).addClass("d-none"),s-=parseFloat(a.data("exposure")),0===t.find("p:visible").length&&(t.find(".empty").show(),s=0)),d&&(p(),f())}),$("input.filter").change(function(){var t=$(this);t.is(":checked")?n.push([t.attr("name"),t.parent().find("label").text()]):n=n.filter(function(a){return a[0]!==t.attr("name")}),u(),d&&(p(),f())});var h=localStorage&&localStorage.getItem("instructions_closed"),v=$("#instructions");h||v.modal("show"),v.on("hide.bs.modal",function(){localStorage&&localStorage.setItem("instructions_closed",!0)})});